<!DOCTYPE html><html class="theme-next muse use-motion" lang="zh-Hans"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"><link href="//fonts.loli.net/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css"><meta name="keywords" content="Hypers Blog Front-End"><link rel="shortcut icon" type="image/x-icon" href="/favicon.png?v=5.1.1"><meta property="og:type" content="website"><meta property="og:title" content="HYPERS 前端团队博客"><meta property="og:url" content="http://blog.rsuitejs.com/index.html"><meta property="og:site_name" content="HYPERS 前端团队博客"><meta property="og:locale" content="zh-Hans"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="HYPERS 前端团队博客"><script type="text/javascript" id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Muse",sidebar:{position:"left",display:"post",offset:12,offset_float:0,b2t:!1,scrollpercent:!1,onmobile:!1},fancybox:!0,motion:!0,duoshuo:{userId:"0",author:"博主"},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><link rel="canonical" href="http://blog.rsuitejs.com/"><title>HYPERS 前端团队博客</title><script>!function(e,t,n,c,a,r,s,h){e[n]=e[n]||[],e[n].push(r),e[r]=e[r]||function(){return(e[r].q=e[r].q||[]).push(arguments)},(s=t.createElement(c)).src="//t.hypers.com.cn/hwt.js?v=1.6",s.async=1,(h=t.getElementsByTagName(c)[0]).parentNode.insertBefore(s,h)}(window,document,"HyperAnalyticsObject","script",0,"_ha"),_ha("create","4080"),_ha("send","pageview")</script></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans"><div class="container sidebar-position-left page-home"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">HYPERS 前端团队博客</span><span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle"></p></div><div class="site-nav-toggle"> <button><span class="btn-bar"></span><span class="btn-bar"></span><span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br> 首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br> 分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br> 归档</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br> 标签</a></li></ul></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div class="hypers-loop-warpper"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 124.51 53.99" id="hypers_loop_svg"><defs><style>.hypers-loop-warpper{position:absolute;top:50px;left:50%;margin-left:-76px}.cls-1{fill:none;stroke-linecap:round;stroke-miterlimit:10;stroke-width:4px;stroke:url(#New_Gradient_Swatch_7)}#hypers_loop_svg{width:152px}#loop_svg path{animation:dash 20s infinite linear;stroke-dasharray:32,10}@keyframes dash{to{stroke-dashoffset:800}}</style><linearGradient id="New_Gradient_Swatch_7" y1="26.99" x2="124.51" y2="26.99" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#51e8ff"/><stop offset="1" stop-color="#1361aa"/></linearGradient></defs><title>loop</title><g id="loop" data-name="图层 2"><g id="loop_svg" data-name="Layer 2"><path class="cls-1" d="M62.2 27 44.7 44.7c-9.8 9.8-25.6 9.8-35.4 0s-9.8-25.6 0-35.4 25.6-9.8 35.4 0l0 0 35.2 35.4c9.8 9.8 25.6 9.8 35.4 0s9.8-25.6 0-35.4-25.6-9.8-35.4 0L62.2 27z"/></g></g></svg></div><div class="starry-warpper"><div class="stars"></div><div class="stars2"></div><div class="stars3"></div></div><section id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://blog.rsuitejs.com/2018/08/30/schema-typed/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Hypers"><meta itemprop="description" content=""><meta itemprop="image" content="/images/hypers_logo.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="HYPERS 前端团队博客"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> <a class="post-title-link" href="/2018/08/30/schema-typed/" itemprop="url">前端数据校验从建模开始</a></h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-30T00:00:00+00:00">2018-08-30</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/前端/" itemprop="url" rel="index"><span itemprop="name">前端</span></a></span></span><div class="post-wordcount"> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计</span> <span title="字数统计">1,386</span></div></div></header><div class="post-body" itemprop="articleBody"><p>前端开发过程中你们觉得处理什么业务功能最烦人？</p><p>做前端已经有很长一段时间了，不知道大家是否和我有同样的感受，在一些 Web 应用中表单处理起来比其他功能模块都麻烦，很多体力活。往往在数据的校验会很费时间。</p><p>为了能够把这部分代码更有条理,我们把数据校验部分通过 Schema 预先定义一个数据模型，把数据扔进去，返回校验结果。</p><p>接下来我介绍一下这个工具，<a href="https://github.com/rsuite/schema-typed" target="_blank" rel="noopener"><code>schema-typed</code></a> 是一个数据建模及数据验证工具, 它可以非常方便的设计的表单数据结构，当然它不限于在表单使用。如果你在产品中使用了 React , 那配合 <a href="https://rsuitejs.com/components/form" target="_blank" rel="noopener">React Suite</a> 的表单组件简直就是如虎添翼。</p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install schema-typed --save</span><br></pre></td></tr></table></figure><h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; SchemaModel, StringType, DateType, NumberType &#125; <span class="keyword">from</span> <span class="string">'schema-typed'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userModel = SchemaModel(&#123;</span><br><span class="line">  username: StringType().isRequired(<span class="string">'用户名不能为空'</span>),</span><br><span class="line">  email: StringType().isEmail(<span class="string">'请输入正确的邮箱'</span>),</span><br><span class="line">  age: NumberType(<span class="string">'年龄应该是一个数字'</span>).range(<span class="number">18</span>, <span class="number">30</span>, <span class="string">'年龄应该在 18 到 30 岁之间'</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> checkResult = userModel.check(&#123;</span><br><span class="line">  username: <span class="string">'foobar'</span>,</span><br><span class="line">  email: <span class="string">'foo@bar.com'</span>,</span><br><span class="line">  age: <span class="number">40</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(checkResult);</span><br></pre></td></tr></table></figure><p><code>checkResult</code> 返回结构是:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    username: &#123; <span class="attr">hasError</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">    email: &#123; <span class="attr">hasError</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">    age: &#123; <span class="attr">hasError</span>: <span class="literal">true</span>, <span class="attr">errorMessage</span>: <span class="string">'年龄应该在 18 到 30 岁之间'</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="多重验证"><a href="#多重验证" class="headerlink" title="多重验证"></a>多重验证</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">StringType()</span><br><span class="line">  .minLength(<span class="number">6</span>, <span class="string">'不能少于 6 个字符'</span>)</span><br><span class="line">  .maxLength(<span class="number">30</span>, <span class="string">'不能大于 30 个字符'</span>)</span><br><span class="line">  .isRequired(<span class="string">'该字段不能为空'</span>);</span><br></pre></td></tr></table></figure><h2 id="自定义验证"><a href="#自定义验证" class="headerlink" title="自定义验证"></a>自定义验证</h2><p>通过 <code>addRule</code> 函数自定义一个规则。</p><p>如果是对一个字符串类型的数据进行验证，可以通过 <code>pattern</code> 方法设置一个正则表达式进行自定义验证。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myModel = SchemaModel(&#123;</span><br><span class="line">  field1: StringType().addRule(<span class="function">(<span class="params">value, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="regexp">/^[1-9][0-9]&#123;3&#125;\s?[a-zA-Z]&#123;2&#125;$/</span>.test(value);</span><br><span class="line">  &#125;, <span class="string">'请输入合法字符'</span>),</span><br><span class="line">  field2: StringType().pattern(<span class="regexp">/^[1-9][0-9]&#123;3&#125;\s?[a-zA-Z]&#123;2&#125;$/</span>, <span class="string">'请输入合法字符'</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">schema.check(&#123; <span class="attr">field1</span>: <span class="string">''</span>, <span class="attr">field2</span>: <span class="string">''</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">  field1: &#123;</span></span><br><span class="line"><span class="comment">    hasError: true,</span></span><br><span class="line"><span class="comment">    errorMessage: '请输入合法字符'</span></span><br><span class="line"><span class="comment">  &#125;,</span></span><br><span class="line"><span class="comment">  field2: &#123;</span></span><br><span class="line"><span class="comment">    hasError: true,</span></span><br><span class="line"><span class="comment">    errorMessage: '请输入合法字符'</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">&#125;;</span></span><br><span class="line"><span class="comment">**/</span></span><br></pre></td></tr></table></figure><h2 id="自定义验证-多字段交叉验证"><a href="#自定义验证-多字段交叉验证" class="headerlink" title="自定义验证 - 多字段交叉验证"></a>自定义验证 - 多字段交叉验证</h2><p>例如，验证两次输入密码是否一致</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> schema = SchemaModel(&#123;</span><br><span class="line">  password1: StringType().isRequired(<span class="string">'该字段不能为空'</span>),</span><br><span class="line">  password2: StringType().addRule(<span class="function">(<span class="params">value, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (value !== data.password1) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;, <span class="string">'两次密码不一致'</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">schema.check(&#123; <span class="attr">password1</span>: <span class="string">'123456'</span>, <span class="attr">password2</span>: <span class="string">'root'</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">  password1: &#123; hasError: false &#125;,</span></span><br><span class="line"><span class="comment">  password2: &#123;</span></span><br><span class="line"><span class="comment">    hasError: true,</span></span><br><span class="line"><span class="comment">    errorMessage: '两次密码不一致'</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment">&#125;;</span></span><br><span class="line"><span class="comment">**/</span></span><br></pre></td></tr></table></figure><h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><ul><li>StringType</li><li>NumberType</li><li>ArrayType</li><li>DateType</li><li>ObjectType</li><li>BooleanType</li></ul><h3 id="StringType"><a href="#StringType" class="headerlink" title="StringType"></a>StringType</h3><ul><li>isRequired()</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">StringType().isRequired(<span class="string">'该字段不能为空'</span>);</span><br></pre></td></tr></table></figure><ul><li>isEmail(String: errorMessage)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">StringType().isEmail(<span class="string">'请输入正确的邮箱地址'</span>);</span><br></pre></td></tr></table></figure><ul><li>isURL(String: errorMessage)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">StringType().isURL(<span class="string">'请输入正确的URL地址'</span>);</span><br></pre></td></tr></table></figure><ul><li>isOneOf(Array: items, String: errorMessage)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">StringType().isOneOf([<span class="string">'Javascript'</span>, <span class="string">'CSS'</span>], <span class="string">'只能输入 `Javascript`和 `CSS`'</span>);</span><br></pre></td></tr></table></figure><ul><li>containsLetter(String: errorMessage)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">StringType().containsLetter(<span class="string">'必须包含英文字符'</span>);</span><br></pre></td></tr></table></figure><ul><li>containsUppercaseLetter(String: errorMessage)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">StringType().containsUppercaseLetter(<span class="string">'必须包含大写的英文字符'</span>);</span><br></pre></td></tr></table></figure><ul><li>containsLowercaseLetter(String: errorMessage)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">StringType().containsLowercaseLetter(<span class="string">'必须包含小写的英文字符'</span>);</span><br></pre></td></tr></table></figure><ul><li>containsLetterOnly(String: errorMessage)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">StringType().containsLetterOnly(<span class="string">'只能包含的英文字符'</span>);</span><br></pre></td></tr></table></figure><ul><li>containsNumber(String: errorMessage)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">StringType().containsNumber(<span class="string">'必须包含数字'</span>);</span><br></pre></td></tr></table></figure><ul><li>pattern(Object: regexp, String: errorMessage)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">StringType().pattern(<span class="regexp">/^[1-9][0-9]&#123;3&#125;\s?[a-zA-Z]&#123;2&#125;$/</span>, <span class="string">'请输入合法字符'</span>);</span><br></pre></td></tr></table></figure><ul><li>rangeLength(Number: minLength, Number: maxLength, String: errorMessage)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">StringType().rangeLength(<span class="number">6</span>, <span class="number">30</span>, <span class="string">'字符个数只能在 6 - 30 之间'</span>);</span><br></pre></td></tr></table></figure><ul><li>minLength(Number: minLength, String: errorMessage)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">StringType().minLength(<span class="number">6</span>, <span class="string">'最小需要6个字符'</span>);</span><br></pre></td></tr></table></figure><ul><li>maxLength(Number: maxLength, String: errorMessage)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">StringType().minLength(<span class="number">30</span>, <span class="string">'最大只能30个字符'</span>);</span><br></pre></td></tr></table></figure><ul><li>addRule(Function: onValid, String: errorMessage)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">StringType().addRule(<span class="function">(<span class="params">value, data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="regexp">/^[1-9][0-9]&#123;3&#125;\s?[a-zA-Z]&#123;2&#125;$/</span>.test(value);</span><br><span class="line">&#125;, <span class="string">'请输入合法字符'</span>);</span><br></pre></td></tr></table></figure><h3 id="NumberType"><a href="#NumberType" class="headerlink" title="NumberType"></a>NumberType</h3><ul><li>isRequired()</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NumberType().isRequired(<span class="string">'该字段必填'</span>);</span><br></pre></td></tr></table></figure><ul><li>isInteger(String: errorMessage)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NumberType().isInteger(<span class="string">'只能是整型'</span>);</span><br></pre></td></tr></table></figure><ul><li>isOneOf(Array: items, String: errorMessage)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NumberType().isOneOf([<span class="number">5</span>, <span class="number">10</span>, <span class="number">15</span>], <span class="string">'只能是`5`,`10`,`15`'</span>);</span><br></pre></td></tr></table></figure><ul><li>pattern(Object: regexp, String: errorMessage)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NumberType().pattern(<span class="regexp">/^[1-9][0-9]&#123;3&#125;$/</span>, <span class="string">'请输入合法字符'</span>);</span><br></pre></td></tr></table></figure><ul><li>range(Number: minLength, Number: maxLength, String: errorMessage)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NumberType().range(<span class="number">18</span>, <span class="number">40</span>, <span class="string">'请输入 18 - 40 之间的数字'</span>);</span><br></pre></td></tr></table></figure><ul><li>min(Number: min, String: errorMessage)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NumberType().min(<span class="number">18</span>, <span class="string">'最小值 18'</span>);</span><br></pre></td></tr></table></figure><ul><li>max(Number: min, String: errorMessage)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NumberType().max(<span class="number">40</span>, <span class="string">'最大值 40'</span>);</span><br></pre></td></tr></table></figure><ul><li>addRule(Function: onValid, String: errorMessage)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NumberType().addRule(<span class="function">(<span class="params">value, data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> value % <span class="number">5</span> === <span class="number">0</span>;</span><br><span class="line">&#125;, <span class="string">'请输入有效的数字'</span>);</span><br></pre></td></tr></table></figure><h3 id="ArrayType"><a href="#ArrayType" class="headerlink" title="ArrayType"></a>ArrayType</h3><ul><li>isRequired()</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ArrayType().isRequired(<span class="string">'该字段必填'</span>);</span><br></pre></td></tr></table></figure><ul><li>rangeLength(Number: minLength, Number: maxLength, String: errorMessage)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ArrayType().rangeLength(<span class="number">1</span>, <span class="number">3</span>, <span class="string">'至少选择1个，但不能超过3个'</span>);</span><br></pre></td></tr></table></figure><ul><li>minLength(Number: minLength, String: errorMessage)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ArrayType().minLength(<span class="number">1</span>, <span class="string">'至少选择1个'</span>);</span><br></pre></td></tr></table></figure><ul><li>maxLength(Number: maxLength, String: errorMessage)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ArrayType().maxLength(<span class="number">3</span>, <span class="string">'不能超过3个'</span>);</span><br></pre></td></tr></table></figure><ul><li>unrepeatable(String: errorMessage)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ArrayType().unrepeatable(<span class="string">'不能出现重复选项'</span>);</span><br></pre></td></tr></table></figure><ul><li>of(Object: type, String: errorMessage)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ArrayType().of(StringType().isEmail(), <span class="string">'格式错误'</span>);</span><br></pre></td></tr></table></figure><ul><li>addRule(Function: onValid, String: errorMessage)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ArrayType().addRule(<span class="function">(<span class="params">value, data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> value.length % <span class="number">2</span> === <span class="number">0</span>;</span><br><span class="line">&#125;, <span class="string">'好事成双'</span>);</span><br></pre></td></tr></table></figure><h3 id="DateType"><a href="#DateType" class="headerlink" title="DateType"></a>DateType</h3><ul><li>isRequired()</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DateType().isRequired(<span class="string">'日期不能为空'</span>);</span><br></pre></td></tr></table></figure><ul><li>range(Date: min, Date: max, String: errorMessage)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DateType().range(</span><br><span class="line">  <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'08/01/2017'</span>),</span><br><span class="line">  <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'08/30/2017'</span>),</span><br><span class="line">  <span class="string">'时间应该在 08/01/2017 - 08/30/2017 之间'</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><ul><li>min(Date: min, String: errorMessage)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DateType().min(<span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'08/01/2017'</span>), <span class="string">'时间的最小值 08/01/2017'</span>);</span><br></pre></td></tr></table></figure><ul><li>max(Date: max, String: errorMessage)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DateType().max(<span class="keyword">new</span> <span class="built_in">Date</span>(<span class="string">'08/30/2017'</span>), <span class="string">'时间的最大值 08/30/2017'</span>);</span><br></pre></td></tr></table></figure><ul><li>addRule(Function: onValid, String: errorMessage)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DateType().addRule(<span class="function">(<span class="params">value, data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> value.getDay() === <span class="number">2</span>;</span><br><span class="line">&#125;, <span class="string">'只能选择周二'</span>);</span><br></pre></td></tr></table></figure><h3 id="ObjectType"><a href="#ObjectType" class="headerlink" title="ObjectType"></a>ObjectType</h3><ul><li>isRequired()</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ObjectType().isRequired(<span class="string">'该对象不能为空'</span>);</span><br></pre></td></tr></table></figure><ul><li>shape(Object: types)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ObjectType().shape(&#123;</span><br><span class="line">  email: StringType().isEmail(<span class="string">'应该是一个 email'</span>),</span><br><span class="line">  age: NumberType().min(<span class="number">18</span>, <span class="string">'年龄应该大于18岁'</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li>addRule(Function: onValid, String: errorMessage)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ObjectType().addRule(<span class="function">(<span class="params">value, data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (value.id || value.email) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;, <span class="string">'id 与 email 必须有一个不能为空'</span>);</span><br></pre></td></tr></table></figure><h3 id="BooleanType"><a href="#BooleanType" class="headerlink" title="BooleanType"></a>BooleanType</h3><ul><li>isRequired()</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BooleanType().isRequired(<span class="string">'该字段不能为空'</span>);</span><br></pre></td></tr></table></figure><ul><li>addRule(Function: onValid, String: errorMessage)</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ObjectType().addRule(<span class="function">(<span class="params">value, data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> value === <span class="string">'undefined'</span> &amp;&amp; A === <span class="number">10</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;, <span class="string">'当 A 等于 10 的时候，该值必须为空'</span>);</span><br></pre></td></tr></table></figure></div><div></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://blog.rsuitejs.com/2018/08/28/react-code-view/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Hypers"><meta itemprop="description" content=""><meta itemprop="image" content="/images/hypers_logo.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="HYPERS 前端团队博客"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> <a class="post-title-link" href="/2018/08/28/react-code-view/" itemprop="url">让 Markdown 中的代码可以实时运行</a></h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-28T00:00:00+00:00">2018-08-28</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/前端/" itemprop="url" rel="index"><span itemprop="name">前端</span></a></span></span><div class="post-wordcount"> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计</span> <span title="字数统计">505</span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>让 Markdown 中的代码可以实时运行，为什么会有这样一个需求？</p><p>在我们前端团队中，技术相关的文档都采用 Markdown 编写， 文档中往往会伴随很多示例代码，我们希望大家在阅读文档的时候，可以运行示例代码，看到效果。</p><h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><ul><li>让 Markdown 中的代码可以运行，并预览效果。</li><li>代码可以在线编辑。</li><li>不影响整个文档流的布局。</li><li>支持 React, 支持代码高亮。</li><li>可以配置 babel。</li></ul><p>明确需求以后，写了一个 React 组件来满足这些功能， <a href="https://github.com/simonguo/react-code-view" target="_blank" rel="noopener"><code>react-code-view</code></a> ， 首先看一下效果：</p><p><img src="https://user-images.githubusercontent.com/1203827/44707274-a30c0f80-aad6-11e8-8cc5-9cf7daf4d9e2.gif" alt="preview"></p><p>在线预览: <a href="https://simonguo.github.io/react-code-view/" target="_blank" rel="noopener">https://simonguo.github.io/react-code-view/</a></p><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><ul><li>就通过 <code>markdown-loader</code> 与 <code>html-loader</code> 解析 Markdown 文档。</li><li>通过正则表达式取出 code ，交给 <code>codemirror</code></li><li>把 <code>codemirror</code> 中的代码通过 babel 编译，再通过 ReactDOM.render 渲染到指定的容器中。</li></ul><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install react-code-view</span><br></pre></td></tr></table></figure><h3 id="配置-webpack"><a href="#配置-webpack" class="headerlink" title="配置 webpack"></a>配置 webpack</h3><p>在 webpack 中需要添加对 <code>markdown-loader</code> 的支持。 需要安装：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install html-loader --save-dev</span><br><span class="line">npm install markdown-loader --save-dev</span><br><span class="line">npm install react-markdown-reader --save-dev</span><br></pre></td></tr></table></figure><p><code>webpack.config.js</code> 配置</p><p><strong>&gt;=webpack 2.x +</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> markdownRenderer = <span class="built_in">require</span>(<span class="string">'react-markdown-reader'</span>).renderer;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.md$/</span>,</span><br><span class="line">  use: [&#123;</span><br><span class="line">    loader: <span class="string">'html-loader'</span></span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    loader: <span class="string">'markdown-loader'</span>,</span><br><span class="line">    options: &#123;</span><br><span class="line">      pedantic: <span class="literal">true</span>,</span><br><span class="line">      renderer: markdownRenderer(<span class="comment">/**languages:Array&lt;string&gt;**/</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>languages 默认值：<code>[&quot;javascript&quot;, &quot;bash&quot;, &quot;xml&quot;, &quot;css&quot;, &quot;markdown&quot;, &quot;less&quot;]</code>;</p><p>Github: <a href="https://github.com/simonguo/react-markdown-reader" target="_blank" rel="noopener">https://github.com/simonguo/react-markdown-reader</a></p><h3 id="添加-Babel"><a href="#添加-Babel" class="headerlink" title="添加 Babel"></a>添加 Babel</h3><p>示例代码中通常是使用到 ES2015+ , React 等，需要对代码实时做编译，所以在 html 中引入 babel :<br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"//cdn.staticfile.org/babel-standalone/6.24.0/babel.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> CodeView <span class="keyword">from</span> <span class="string">'react-code-view'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'~react-code-view/lib/less/index.less'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; Button &#125; <span class="keyword">from</span> <span class="string">'rsuite'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;CodeView dependencies=&#123;&#123; Button &#125;&#125; &gt;</span><br><span class="line">  &#123;<span class="built_in">require</span>(<span class="string">'./example.md'</span>)&#125;</span><br><span class="line">&lt;<span class="regexp">/CodeView&gt;</span></span><br></pre></td></tr></table></figure><p>源代码都统一写在 markdown 中，参考:<br><a href="https://raw.githubusercontent.com/simonguo/react-code-view/master/docs/example.md" target="_blank" rel="noopener">example.md</a></p><blockquote><p>这里需要注意的是把需要运行的代码一定要放在 <code>&lt;!--start-code--&gt;</code> 与 <code>&lt;!--end-code--&gt;</code> 之间。</p></blockquote><h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><table><thead><tr><th>Name</th><th>Type</th><th>Default value</th><th>Description</th></tr></thead><tbody><tr><td>dependencies</td><td>Object</td><td></td><td>依赖的组件</td></tr><tr><td>showCode</td><td>boolean</td><td>true</td><td>显示代码</td></tr><tr><td>babelTransformOptions</td><td>Object</td><td>{ presets: [‘stage-0’, ‘react’, ‘es2015’] }</td><td>babel 配置参数 <a href="https://babeljs.io/docs/usage/api/#options" target="_blank" rel="noopener">options</a></td></tr></tbody></table><h2 id="谁在用？"><a href="#谁在用？" class="headerlink" title="谁在用？"></a>谁在用？</h2><ul><li><a href="https://rsuitejs.com/components/button" target="_blank" rel="noopener">React Suite</a></li></ul></div><div></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://blog.rsuitejs.com/2018/05/29/cdnjs/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Hypers"><meta itemprop="description" content=""><meta itemprop="image" content="/images/hypers_logo.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="HYPERS 前端团队博客"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> <a class="post-title-link" href="/2018/05/29/cdnjs/" itemprop="url">提交一个仓库到 CDNJS</a></h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-29T10:16:20+00:00">2018-05-29</time></span><div class="post-wordcount"> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计</span> <span title="字数统计">2,370</span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><img src="/2018/05/29/cdnjs/cdnjs-home-screenshoot.png" title="cdnjs 官网截屏"><p>本篇文章主要介绍了：如何提交自己的库到 <a href="https://cdnjs.com/" target="_blank" rel="noopener">cdnjs</a>，提交要求，详细的提交步骤及遇到的问题与解决办法。</p><div class="post-button text-center"> <a class="btn" href="/2018/05/29/cdnjs/#more" rel="contents">阅读全文 &raquo;</a></div></div><div></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://blog.rsuitejs.com/2018/04/25/rsuite-v3/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Hypers"><meta itemprop="description" content=""><meta itemprop="image" content="/images/hypers_logo.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="HYPERS 前端团队博客"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> <a class="post-title-link" href="/2018/04/25/rsuite-v3/" itemprop="url">React Suite v3.0 正式版发布</a></h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-25T00:00:00+00:00">2018-04-25</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/前端/" itemprop="url" rel="index"><span itemprop="name">前端</span></a></span></span><div class="post-wordcount"> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计</span> <span title="字数统计">477</span></div></div></header><div class="post-body" itemprop="articleBody"><p>相信很多人会好奇，React Suite 是什么？</p><p><img src="https://user-images.githubusercontent.com/1203827/39177217-3c49254c-47e1-11e8-9380-760c9e25c48e.png" alt=""></p><p>React Suite 是 HYPERS 前端团队和 UX 团队开源的一套基于 React 的 UI 组件库，能够帮助您快速构建一个企业级应用。</p><p>官网访问地址： <a href="https://rsuitejs.com" target="_blank" rel="noopener">rsuitejs.com</a></p><div class="post-button text-center"> <a class="btn" href="/2018/04/25/rsuite-v3/#more" rel="contents">阅读全文 &raquo;</a></div></div><div></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://blog.rsuitejs.com/2018/04/19/webpack-mutiple-theme-solution/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Hypers"><meta itemprop="description" content=""><meta itemprop="image" content="/images/hypers_logo.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="HYPERS 前端团队博客"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> <a class="post-title-link" href="/2018/04/19/webpack-mutiple-theme-solution/" itemprop="url">webpack 换肤功能多主题/配色样式打包解决方案</a></h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-19T19:15:52+00:00">2018-04-19</time></span><div class="post-wordcount"> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计</span> <span title="字数统计">1,800</span></div></div></header><div class="post-body" itemprop="articleBody"> <img src="/2018/04/19/webpack-mutiple-theme-solution/pallete.jpg" title="色阶"><p>本文主要详细介绍了，如何使用 <a href="https://webpack.js.org/" target="_blank" rel="noopener">webpack</a>，打包多套不同主题的解决方案以及实践中所遇到的问题。</p><div class="post-button text-center"> <a class="btn" href="/2018/04/19/webpack-mutiple-theme-solution/#more" rel="contents">阅读全文 &raquo;</a></div></div><div></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://blog.rsuitejs.com/2018/04/11/es2016-17-18/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Hypers"><meta itemprop="description" content=""><meta itemprop="image" content="/images/hypers_logo.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="HYPERS 前端团队博客"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> <a class="post-title-link" href="/2018/04/11/es2016-17-18/" itemprop="url">ECMAScript 2016, 2017, 和2018中新增功能的示例</a></h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-11T00:00:00+00:00">2018-04-11</time></span><div class="post-wordcount"> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计</span> <span title="字数统计">6,651</span></div></div></header><div class="post-body" itemprop="articleBody"><h1 id="以下是-ECMAScript-2016-2017-和-2018-中新增功能的示例"><a href="#以下是-ECMAScript-2016-2017-和-2018-中新增功能的示例" class="headerlink" title="以下是 ECMAScript 2016, 2017, 和 2018 中新增功能的示例"></a>以下是 ECMAScript 2016, 2017, 和 2018 中新增功能的示例</h1><p><a href="https://medium.freecodecamp.org/here-are-examples-of-everything-new-in-ecmascript-2016-2017-and-2018-d52fa3b5a70e" target="_blank" rel="noopener">原文链接</a></p><p>要跟上 JavaScript(ECMAScript) 更新的脚步很难，更难的是找到有用的代码示例。</p><p>因此，在本文中，我将介绍在 ES2016，ES2017 和 ES2018（最终草案）中添加的TC39已完成提案中列出的所有 18 个新特性，并一一展示有用的示例。</p><blockquote><p>这篇文章很长，不过应该很容易读，可以当成一篇“Netflix binge reading”。我保证你读完后将对这些新特性有很多的了解。</p></blockquote><p><strong>好，我们一个一个来看看。</strong></p><div class="post-button text-center"> <a class="btn" href="/2018/04/11/es2016-17-18/#more" rel="contents">阅读全文 &raquo;</a></div></div><div></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://blog.rsuitejs.com/2018/04/04/webkit-render/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Hypers"><meta itemprop="description" content=""><meta itemprop="image" content="/images/hypers_logo.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="HYPERS 前端团队博客"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> <a class="post-title-link" href="/2018/04/04/webkit-render/" itemprop="url">浏览器渲染引擎</a></h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-04T00:00:00+00:00">2018-04-04</time></span><div class="post-wordcount"> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计</span> <span title="字数统计">3,548</span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>浏览器的内核中主要分为渲染引擎和 javascript 引擎，本篇主要围绕渲染引擎介绍一下浏览器的工作原理。</p><p>首先，我们先看几个 user-agent 的字符串：</p><ul><li>Mozilla/ 1.0 (Windows NT 6.1;rv:2.0.1) Gecko/2010010Firefox/4.0.1</li><li>Mozilla/ 4. 0 (compatible; MSIE 7. 0; Windows NT 6. 0)</li><li>Mozilla/ 5. 0 (Linux; Android4. 0. 4; Galaxy Nexus Build/ IMM76B) AppleWebKit/ 535. 19 (KHTML, like Gecko) Chrome/ 18. 0. 1025. 133 Mobile Safari/ 535.</li></ul><p>这是 3 个不同浏览器的 user-agent，第 1 个是 Firefox 的，第 2 个是 IE7 的，第 3 个是 Chrome 的。有没有觉得很奇怪，为什么所有字符串的前面都会有一个 Mozilla 开头呢？ 而且在 Chrome 中包含了很多其他浏览器的标识，Android，Gecko，Safari … , 这些浏览器厂商为什么要把这个 user-agent 字符串设计成这样？user-agent 按照正常的理解就是浏览器的标识，包含操作系统和浏览器信息带上版本号就行了，浏览器厂商为什么搞的这么复杂呢？</p><p>这需要了解一下 user-agent 字符串历史 ，大致的意思是， 早期的浏览器 Netscape 的 user-agent 是以 <code>Mozilla/Version [Language] (Platform; Encryption)</code> 的格式，大多数服务器在加载页面前都会检查 user-agent 是否为该款浏览器，然而在 1995 年， IE 发布首款浏览器，如果不兼容 Netscape user-agent 字串，用户就根本访问不了页面，于是 IE 就设计了这种格式： <code>Mozilla/2.0 (compatible; MSIE Version; Operating System)</code> 。 其他新的浏览器发布也是一样的，为了溶入主流而不被踢出局，在 user-agent 字串中放详尽的信息，以便骗取网站的信任使它与其它流行的浏览器兼容。</p><p>接下来，简单回顾一下浏览器的历史:</p><ul><li>WorldWideWeb 1991 年</li><li>Mosaic 1993 年</li><li>Netscape 1994 年</li><li>Opera 1995 年</li><li>IE 1995 年 一战</li><li>Safari 2003 年</li><li>Firefox 2004 年 二战</li><li>Chrome 2008 年</li><li>Edge 2015 年</li></ul><p>很多人都以为最早的浏览器是 Netscape， 其实在 Netscape 之前还有 WorldWideWeb 和 Mosaic 两个浏览器，WorldWideWeb 是世界上第一个浏览器，它同时也是一个编辑器，在 1991 年发布, 当时 http 的版本还是 0.9 ，只支持 get 请求。</p><p>随后在 1993 年 由美国伊利诺州的伊利诺大学的 NCSA 组织，发布第一个可以显示图片的浏览器，叫 Mosaic。随后 NCSA 将 Mosaic 的商业运营权转售给了 Spyglass 公司，该公司又向包括微软公司在内的多家公司技术授权，然后，微软的 IE 浏览器就是从这里开始了。<br>1994 年，在 Mosaic 浏览器开发团队的核心成员，重新成立 Netscape 公司，从此 Netscape 浏览器诞生。<br>1995 年，挪威的本土电信公司 Telenor 开发了一个新的浏览器 Opera，Opera 浏览器他特点就是速度快，但是兼容性不是很好，在浏览器上独创了很多功能，比如标签式浏览就是 Opera 发明的，Opera 在经历很多坎坷后，在 2016 年被奇虎 360 收购。<br>1995 同年，微软在取得 Spyglass Mosaic 的源代码和授权后，发布了首款浏览器 Internet Explorer ，从此展开浏览器第一次大战。<br>1998 年，Netscape 公司内部成立 Mozilla 组织。<br>2003 年，苹果公司发布了自己第一个浏览器 Safari，同时在两年后，也就是<br>2005 年开源了自己的浏览器内核 Webkit。<br>2004 年，Mozilla 组织发布了 Firefox 浏览器，然后第二次浏览器大战开始。<br>2008 年，是一个灾难很多的一年，四川大地震，过年回家又遇上雪灾，作为前端开发我的将要开始兼容一个由 Goolge 开发新的 Chrome 浏览器。 但是 Chrome 带来的体验是让人开心的 。<br>2015 年，微软随着 Windows 10 一起发布 Edge 浏览器，伤透大家心的 IE ，估计维护不下去。</p><p>当前市场浏览器市场占比最高的是 Chrome 浏览器，其次就是 IE，Firefox ，详细占比查看 Net Marketshare 的统计。</p><div class="post-button text-center"> <a class="btn" href="/2018/04/04/webkit-render/#more" rel="contents">阅读全文 &raquo;</a></div></div><div></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://blog.rsuitejs.com/2018/03/28/build-a-app-width-electron-and-react/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Hypers"><meta itemprop="description" content=""><meta itemprop="image" content="/images/hypers_logo.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="HYPERS 前端团队博客"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> <a class="post-title-link" href="/2018/03/28/build-a-app-width-electron-and-react/" itemprop="url">如何使用 Electron 和 React 构建一个 APP</a></h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-28T18:44:08+00:00">2018-03-28</time></span><div class="post-wordcount"> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计</span> <span title="字数统计">2,744</span></div></div></header><div class="post-body" itemprop="articleBody"><p>这篇文章主要记录了，使用 Electron 构建的一个 APP 过程的关键步骤和遇到的问题及解决方法。</p><h1 id="最终成品效果图"><a href="#最终成品效果图" class="headerlink" title="最终成品效果图"></a>最终成品效果图</h1><img src="/2018/03/28/build-a-app-width-electron-and-react/electron-preview.gif" title="最终效果图"><p><a href="https://github.com/hiyangguo/bt-radish-app" target="_blank" rel="noopener">查看源码</a></p><div class="post-button text-center"> <a class="btn" href="/2018/03/28/build-a-app-width-electron-and-react/#more" rel="contents">阅读全文 &raquo;</a></div></div><div></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://blog.rsuitejs.com/2018/01/22/react-webpack-optimize/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Hypers"><meta itemprop="description" content=""><meta itemprop="image" content="/images/hypers_logo.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="HYPERS 前端团队博客"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> <a class="post-title-link" href="/2018/01/22/react-webpack-optimize/" itemprop="url">React + Webpack 构建打包优化</a></h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-22T23:26:50+00:00">2018-01-22</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/技术/" itemprop="url" rel="index"><span itemprop="name">技术</span></a></span></span><div class="post-wordcount"> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计</span> <span title="字数统计">1,887</span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="React-相关的优化"><a href="#React-相关的优化" class="headerlink" title="React 相关的优化"></a>React 相关的优化</h2><ul><li>使用 <a href="https://github.com/thejameskyle/babel-react-optimize" target="_blank" rel="noopener">babel-react-optimize</a> 对 React 代码进行优化</li><li>检查没有使用的库，去除 import 引用</li><li>按需打包所用的类库，比如 <code>lodash</code> 、<code>echarts</code> 等</li></ul><p><code>lodash</code> 可以采用 <a href="https://github.com/lodash/babel-plugin-lodash" target="_blank" rel="noopener">babel-plugin-lodash</a> 进行优化。<br><strong>需要注意的是</strong></p><p>在 <code>babel-react-optimize</code> 中使用了 <code>babel-plugin-transform-react-remove-prop-types</code> 这个插件。正常情况下，如果你在代码中没有引用到组件的 <code>PropTypes</code>，则完全没问题。如果你的组件用到了，那么使用该插件可能会导致问题。<br>具体见：</p><blockquote><p><a href="https://github.com/oliviertassinari/babel-plugin-transform-react-remove-prop-types#is-it-safe" target="_blank" rel="noopener">https://github.com/oliviertassinari/babel-plugin-transform-react-remove-prop-types#is-it-safe</a></p></blockquote><h2 id="Webpack-构建打包优化"><a href="#Webpack-构建打包优化" class="headerlink" title="Webpack 构建打包优化"></a>Webpack 构建打包优化</h2><p>Webpack 构建打包存在的问题主要集中于下面两个方面：</p><ul><li>Webpack 构建速度慢</li><li>Webpack 打包后的文件体积过大</li></ul><h3 id="Webpack-构建速度慢"><a href="#Webpack-构建速度慢" class="headerlink" title="Webpack 构建速度慢"></a>Webpack 构建速度慢</h3><p>可以使用 <code>Webpack.DDLPlugin</code>，<code>HappyPack</code> 来提高构建速度。具体参见小铭在 DMP DDLPlugin 的文档。原文如下：</p><h4 id="Webpack-DLLPlugin"><a href="#Webpack-DLLPlugin" class="headerlink" title="Webpack.DLLPlugin"></a>Webpack.DLLPlugin</h4><ul><li>添加一个 webpack.dll.config.js</li></ul><p>主要是用到一个 DllPlugin 插件，把一些第三方的资源独立打包，同时放到一个 manifest.json 配置文件中，<br>这样在组件中更新后，就不会重新 build 这些第三方的资源，</p><ul><li>同时独立配置 dll/vendors.js 文件，提供给 webpack.dll.config.js</li><li>修改 package.json</li></ul><p>在 scripts 中添加: <code>&quot;dll&quot;: &quot;webpack --config webpack.dll.config.js --progress --colors &quot;,</code>。<br>执行 npm run dll 以后，会在 dll 目录下生产 两个文件 vendor-manifest.json ，vendor.dll.js</p><ul><li>配置 webpack.dev.config.js 文件，加入一个 DllReferencePlugin 插件，并指定 vendor-manifest.json 文件</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.DllReferencePlugin(&#123;</span><br><span class="line">  context: join(__dirname, <span class="string">'src'</span>),</span><br><span class="line">  manifest: <span class="built_in">require</span>(<span class="string">'./dll/vendor-manifest.json'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>修改 html</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%</span> <span class="attr">if</span>(<span class="attr">htmlWebpackPlugin.options.NODE_ENV</span> ===<span class="string">'development'</span>)&#123;   %&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"dll/vendor.dll.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%</span> &#125; %&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>注意，需要在 htmlWebpackPlugin 插件中配置 NODE_ENV 参数</p></blockquote><h4 id="Happypack"><a href="#Happypack" class="headerlink" title="Happypack"></a>Happypack</h4><p>通过多线程，缓存等方式提升 rebuild 效率 <a href="https://github.com/amireh/happypack" target="_blank" rel="noopener">https://github.com/amireh/happypack</a></p><ul><li>在 webpack.dev.config.js 中针对不同的资源创建多个 HappyPack, 比如 js 1 个，less 1 个，并设置好 id</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> HappyPack(&#123;</span><br><span class="line">  id: <span class="string">'js'</span>,</span><br><span class="line">  threadPool: happyThreadPool,</span><br><span class="line">  cache: <span class="literal">true</span>,</span><br><span class="line">  verbose: <span class="literal">true</span>,</span><br><span class="line">  loaders: [<span class="string">'babel-loader?babelrc&amp;cacheDirectory=true'</span>],</span><br><span class="line">&#125;),</span><br><span class="line"><span class="keyword">new</span> HappyPack(&#123;</span><br><span class="line">  id: <span class="string">'less'</span>,</span><br><span class="line">  threadPool: happyThreadPool,</span><br><span class="line">  cache: <span class="literal">true</span>,</span><br><span class="line">  verbose: <span class="literal">true</span>,</span><br><span class="line">  loaders: [<span class="string">'css-loader'</span>, <span class="string">'less-loader'</span>],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ul><li>在 module.rules 中配置 use 为 happypack/loader， 设置 id</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">  use: [</span><br><span class="line">    <span class="string">'happypack/loader?id=js'</span></span><br><span class="line">  ],</span><br><span class="line">  exclude: <span class="regexp">/node_modules/</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">  test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">  loader: extractLess.extract(&#123;</span><br><span class="line">    use: [<span class="string">'happypack/loader?id=less'</span>],</span><br><span class="line">    fallback: <span class="string">'style-loader'</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="减少-Webpack-打包后的文件体积大小"><a href="#减少-Webpack-打包后的文件体积大小" class="headerlink" title="减少 Webpack 打包后的文件体积大小"></a>减少 Webpack 打包后的文件体积大小</h3><p>首先需要对我们整个 bundle 进行分析，由哪些东西组成及各组成部分所占大小。<br>这里推荐 <a href="https://github.com/webpack-contrib/webpack-bundle-analyzer" target="_blank" rel="noopener">webpack-bundle-analyzer</a>。安装后在 <code>webpack.dev.config.js</code> 中添加插件即可，就能在每次启动后自动在网站打开分析结果，如下图</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plugins.push( <span class="keyword">new</span> BundleAnalyzerPlugin());</span><br></pre></td></tr></table></figure> <img src="/2018/01/22/react-webpack-optimize/bundle.png" title="react bundle"><p>除此之外，还可以将打包过程输出成json文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webpack --profile --json -&gt; stats.json</span><br></pre></td></tr></table></figure><p>然后到下面这两个网站进行分析</p><ul><li><a href="http://webpack.github.io/analyse" target="_blank" rel="noopener">webpack/analyse</a></li><li><a href="http://alexkuz.github.io/webpack-chart/" target="_blank" rel="noopener">Webpack Chart</a></li></ul><p>通过上面的图表分析可以清楚得看到，整个 bundle.js 的组成部分及对应的大小。<br>解决 bundle.js 体积过大的解决思路如下：</p><ul><li>生产环境启用压缩等插件，去除不必要插件</li><li>拆分业务代码与第三方库及公共模块</li><li>webpack 开启 gzip 压缩</li><li>按需加载</li></ul><h4 id="生产环境启用压缩等插件，去除不必要插件"><a href="#生产环境启用压缩等插件，去除不必要插件" class="headerlink" title="生产环境启用压缩等插件，去除不必要插件"></a>生产环境启用压缩等插件，去除不必要插件</h4><p>确保在生产环境启动 <code>webpack.DefinePlugin</code> 和 <code>webpack.optimize.UglifyJsPlugin</code>。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> plugins = [</span><br><span class="line">  <span class="keyword">new</span> webpack.DefinePlugin(&#123;</span><br><span class="line">    <span class="string">'process.env.NODE_ENV'</span>: <span class="built_in">JSON</span>.stringify(process.env.NODE_ENV || <span class="string">'production'</span>)</span><br><span class="line">  &#125;),</span><br><span class="line">    <span class="keyword">new</span> webpack.optimize.UglifyJsPlugin(&#123;</span><br><span class="line">    compress: &#123;</span><br><span class="line">      warnings: <span class="literal">false</span>,</span><br><span class="line">      drop_console: <span class="literal">false</span> <span class="comment">//eslint-disable-line</span></span><br><span class="line">    &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h4 id="拆分业务代码与第三方库及公共模块"><a href="#拆分业务代码与第三方库及公共模块" class="headerlink" title="拆分业务代码与第三方库及公共模块"></a>拆分业务代码与第三方库及公共模块</h4><p>由于项目的业务代码变更频率很高，而第三方库的代码变化则相对没有那么频率。如果将业务代码和第三库打包到同一个 chunk 的话，在每次构建的时候，哪怕业务代码只改了一行，即使第三方库的代码没有发生变化，会导致整个 chunk 的 hash 跟上一次不同。这不是我们想要的结果。我们想要的是，如果第三方库的代码没有变化，那在构建的时候也要保证对应的 hash 没有发生变化，从而能利用浏览器缓存，更好的提高页面加载性能和缩短页面加载时间。<br>因此可以将第三库的代码单独拆分成 vendor chunk，与业务代码分离。这样就算业务代码再怎么发生变化，只要第三方库代码没有发生变化，对应的 hash 就不变。<br>首先 <code>entry</code> 配置两个 <code>app</code> 和 <code>vendor</code> 两个chunk</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">entry: &#123;</span><br><span class="line">  vendor: [path.join(__dirname, <span class="string">'dll'</span>, <span class="string">'vendors.js'</span>)],</span><br><span class="line">  app: [path.join(__dirname, <span class="string">'src/index'</span>)]</span><br><span class="line">&#125;,</span><br><span class="line">output: &#123;</span><br><span class="line">  path: path.resolve(__dirname, <span class="string">'build'</span>),</span><br><span class="line">  filename: <span class="string">'[name].[chunkhash:8].js'</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>其中 <code>vendros.js</code> 是自己定义的哪些第三方库需要纳入 vendor 中，如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'babel-polyfill'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'classnames'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'intl'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'isomorphic-fetch'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'react'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'react-dom'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'immutable'</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">'redux'</span>);</span><br></pre></td></tr></table></figure><p>然后通过 <code>CommonsChunkPlugin</code> 拆分第三库</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">plugins.push(</span><br><span class="line">  <span class="comment">// 拆分第三方库</span></span><br><span class="line">  <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123; <span class="attr">name</span>: <span class="string">'vendor'</span> &#125;),</span><br><span class="line">  <span class="comment">// 拆分 webpack 自身代码</span></span><br><span class="line">  <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">    name: <span class="string">'runtime'</span>,</span><br><span class="line">    minChunks: <span class="literal">Infinity</span></span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>上面的配置有两个细节需要注意</p><ul><li>使用 <code>chunkhash</code> 而不用 <code>hash</code></li><li>单独拆分 webpack 自身代码</li></ul><p><strong>使用 <code>chunkhash</code> 而不用 <code>hash</code></strong></p><p>先来看看这二者有何区别：</p><ul><li>hash 是 <strong>build-specific</strong>，任何一个文件的改动都会导致编译的结果不同，适用于开发阶段</li><li>chunkhash 是 <strong>chunk-specific</strong>，是根据每个 chunk 的内容计算出的 hash，适用于生产</li></ul><p>因此为了保证第三方库不变的情况下，对应的 <code>vendor.js</code> 的 <code>hash</code> 也要保持不变，我们再 <code>output.filename</code> 中采用了 <code>chunkhash</code></p><p><strong>单独拆分 webpack 自身代码</strong></p><p>Webpack 有个已知问题：</p><blockquote><p>webpack 自身的 boilerplate 和 manifest 代码可能在每次编译时都会变化。</p></blockquote><p>这导致我们只是在 入口文件 改了一行代码，但编译出的 vendor 和 entry chunk 都变了，因为它们自身都包含这部分代码。</p><p>这是不合理的，因为实际上我们的第三方库的代码没变，vendor 不应该在我们业务代码变化时发生变化。<br>因此我们需要将 webpack 这部分代码分离抽离</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">      name: <span class="string">"runtime"</span>,</span><br><span class="line">      minChunks: <span class="literal">Infinity</span></span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure><p>其中的 name 只要不在 entry 即可，通常使用 <code>&quot;runtime&quot;</code> 或 <code>&quot;manifest&quot;</code>。<br>另外一个参数 <code>minChunks</code> 表示：在传入公共chunk(commons chunk) 之前所需要包含的最少数量的 chunks。数量必须大于等于2，或者少于等于 chunks的数量，传入 <code>Infinity</code> 会马上生成 公共chunk，但里面没有模块。</p><p>更多关于 <code>CommonChunkPlugin</code> 可以查看 <a href="https://doc.webpack-china.org/plugins/commons-chunk-plugin/" target="_blank" rel="noopener">官方文档</a></p><h4 id="拆分公共资源"><a href="#拆分公共资源" class="headerlink" title="拆分公共资源"></a>拆分公共资源</h4><p>同 上面的拆分第三方库一样，拆分公共资源可以将公用的模块单独打出一个 chunk，你可以设置 <code>minChunk</code> 来选择是共用多少次模块才将它们抽离。配置如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</span><br><span class="line">  name: <span class="string">'common'</span>,</span><br><span class="line">  minChunks: <span class="number">2</span>,</span><br><span class="line">&#125;),</span><br></pre></td></tr></table></figure><p>是否需要进行这一步优化可以自行根据项目的业务复用度来判断。</p><h4 id="开启-gzip"><a href="#开启-gzip" class="headerlink" title="开启 gzip"></a>开启 gzip</h4><p>使用 <code>CompressionPlugin</code> 插件开启 <code>gzip</code> 即可：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加 gzip</span></span><br><span class="line"><span class="keyword">new</span> CompressionPlugin(&#123;</span><br><span class="line">  asset: <span class="string">'[path].gz[query]'</span>,</span><br><span class="line">  algorithm: <span class="string">'gzip'</span>,</span><br><span class="line">  test: <span class="regexp">/\.(js|html)$/</span>,</span><br><span class="line">  threshold: <span class="number">10240</span>,</span><br><span class="line">  minRatio: <span class="number">0.8</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="按需加载"><a href="#按需加载" class="headerlink" title="按需加载"></a>按需加载</h4><p>本篇不做具体介绍</p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul><li><a href="https://github.com/creeperyang/blog/issues/37" target="_blank" rel="noopener">Webpack 日常使用与优化</a></li><li><a href="https://juejin.im/entry/5a41fbea6fb9a045117161a1" target="_blank" rel="noopener">使用 Webpack 打包单页应用的正确姿势</a></li><li><a href="https://zhuanlan.zhihu.com/p/25212283" target="_blank" rel="noopener">webpack打包分析与性能优化</a></li><li><a href="https://github.com/happylindz/blog/issues/7" target="_blank" rel="noopener">Webpack 持久化缓存实践</a></li><li><a href="https://github.com/happylindz/blog/issues/6" target="_blank" rel="noopener">深入理解 webpack 文件打包机制</a></li></ul><blockquote><p>本文作者：<a href="github.com/superman66">超人</a></p></blockquote></div><div></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://blog.rsuitejs.com/2017/09/09/form-lib/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Hypers"><meta itemprop="description" content=""><meta itemprop="image" content="/images/hypers_logo.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="HYPERS 前端团队博客"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> <a class="post-title-link" href="/2017/09/09/form-lib/" itemprop="url">小而美的 React Form 组件</a></h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-09T00:00:00+00:00">2017-09-09</time></span> <span class="post-category"><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/前端/" itemprop="url" rel="index"><span itemprop="name">前端</span></a></span></span><div class="post-wordcount"> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">字数统计</span> <span title="字数统计">3,347</span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>之间在一篇介绍过 Table 组件<a href="http://blog.hypers.io/2017/09/03/rsuite-table/" target="_blank" rel="noopener">《React 实现一个漂亮的 Table》</a> 的文章中讲到过，在企业级后台产品中，用的最多且复杂的组件主要包括 Table、 Form、 Chart，在处理 Table 的时候我们遇到了很多问题。今天我们这篇文章主要是分享一下 Form 组件，在业务开发中， 相对 Table 来说，Form 处理起来更麻烦，不是所有表单都像注册页面那样简单，它往往需要处理非常多的逻辑，比如：</p><ul><li>需要处理数据验证逻辑。</li><li>在一个项目中的很少有可以复用的表单，每个表单的逻辑都需要单独处理。</li><li>在表单中往往存在需要自定义的组件，比如：Toggle、Tree、Picker 等等。</li></ul><p>Form 作为一个功能型组件，它需要解决的问题无非就是两个：</p><ul><li>把一个数据对象扔给它，它能够在让 Form 内的交互型组件获取到数据并展示出来，同时这些组件上的数据也能反过来让 Form 组件获取到。</li><li>对数据的有效性进行验证。</li></ul><blockquote><p>在 React 项目开发中没有用过其他 Form 相关的组件，但是这里我又忍不住想和 Ant Design 的 Form 对比一下，以下是我在 antd 官网上的一个截图：</p></blockquote> <img src="/2017/09/09/form-lib/antd-form.png" title="antd form"><p>大家可以通过以上图片看到，我想输入自己的中文名字都不能正常输入，这里主要存在两个问题：</p><ul><li>onChange 被触发了多次，在一次中文未完整的输入前，不应该触发 <code>onChange</code> 事件。</li><li>另外，中文在文本框内就不能正常显示。</li></ul><p>我在想这两个问题不在组件上处理，在哪里处理的呢？访问地址: <a href="https://ant.design/components/form-cn/" target="_blank" rel="noopener">https://ant.design/components/form-cn/</a> 可以试一下，也希望他们可以解决掉这个问题。这个问题应该怎么解决，我之前做过记录: <a href="https://github.com/hypers/blog/blob/master/source/_posts/react-issue.md#react-中-在-controlled受控制的文本框中输入中文-onchange-会触发多次" target="_blank" rel="noopener">React 中, 在 Controlled(受控制)的文本框中输入中文 onChange 会触发多次</a>。</p><p>我们在设计的时候自然是解决了这些问题，预览效果: <a href="https://rsuitejs.com/form-lib/" target="_blank" rel="noopener">https://rsuitejs.com/form-lib/</a> ，接下来看一下具体的设计。</p><div class="post-button text-center"> <a class="btn" href="/2017/09/09/form-lib/#more" rel="contents">阅读全文 &raquo;</a></div></div><div></div><div></div><div></div><footer class="post-footer"><div class="post-eof"></div></footer></article></section><nav class="pagination"> <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a></nav></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span><span class="sidebar-toggle-line sidebar-toggle-line-middle"></span><span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><section class="site-overview sidebar-panel sidebar-panel-active"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" src="/images/hypers_logo.png" alt="Hypers"><p class="site-author-name" itemprop="name">Hypers</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">22</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/index.html"><span class="site-state-item-count">2</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/index.html"><span class="site-state-item-count">44</span> <span class="site-state-item-name">标签</span></a></div></nav><div class="links-of-author motion-element"></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright"> &copy; <span itemprop="copyrightYear">2018</span><span class="with-love"><i class="fa fa-heart"></i></span> <span class="author" itemprop="copyrightHolder">Hypers</span> <span class="post-count">- 全站共50.2k字</span></div><div class="powered-by"> 由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动</div><div class="theme-info"> 主题 - <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script><script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script><script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script></body></html>